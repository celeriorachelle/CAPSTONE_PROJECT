<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Settings</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/settings.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <%- include('partials/sidebar') %>
  <div class="main" id="main">
    <%- include('partials/topbar', { title: "Settings" }) %>

    <div class="main-content settings-page">
      <% if (success) { %>
        <p class="success"><%= success %></p>
      <% } %>

      <section class="settings-header">
        <div class="avatar-container">
          <img src="<%= formData.avatar %>" id="avatarPreview" alt="Avatar">
          <button class="edit-avatar"><i class="fa fa-camera"></i></button>
          <form id="avatarForm" action="/settings/update-avatar" method="POST" enctype="multipart/form-data" style="display:none;">
            <input type="file" id="avatarInput" name="avatar" accept="image/*">
          </form>
        </div>

        <form class="settings-form" action="/settings" method="POST">
          <label>
            <input type="checkbox" name="darkMode" <%= formData.darkMode ? 'checked' : '' %> />
            Dark Mode
          </label>
          <label>
            <input type="checkbox" name="notifications" <%= formData.notifications ? 'checked' : '' %> />
            Notifications
          </label>
          <button type="submit" class="btn save">Save Settings</button>
        </form>
      </section>
    </div>
</div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const avatarBtn = document.querySelector(".edit-avatar");
      const avatarInput = document.getElementById("avatarInput");
      const avatarForm = document.getElementById("avatarForm");
      const avatarPreview = document.getElementById("avatarPreview");
      const darkModeCheckbox = document.querySelector('input[name="darkMode"]');

      // --- Avatar Upload ---
      avatarBtn.addEventListener("click", () => avatarInput.click());
      avatarInput.addEventListener("change", () => {
        if (avatarInput.files.length > 0) {
          const reader = new FileReader();
          reader.onload = (e) => {
            avatarPreview.src = e.target.result;
            localStorage.setItem("tempAvatar", e.target.result);
          };
          reader.readAsDataURL(avatarInput.files[0]);
          avatarForm.submit();
        }
      });

      // Restore avatar from localStorage
      const tempAvatar = localStorage.getItem("tempAvatar");
      if (tempAvatar) avatarPreview.src = tempAvatar;

      // --- Dark Mode ---
      function applyDarkMode(enabled) {
        if (enabled) document.body.classList.add("dark-mode");
        else document.body.classList.remove("dark-mode");
      }

      const savedDarkMode = localStorage.getItem("darkMode") === "true";
      darkModeCheckbox.checked = savedDarkMode;
      applyDarkMode(savedDarkMode);

      darkModeCheckbox.addEventListener("change", () => {
        const enabled = darkModeCheckbox.checked;
        applyDarkMode(enabled);
        localStorage.setItem("darkMode", enabled);
      });
    });
  </script>
</body>
</html>

</body>
</html>
