<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plot Inventory</title>
  <link rel="stylesheet" href="/stylesheets/admin_inventory.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h2>Everlasting Peace <br>Memorial Park</h2>
      <div class="nav-links">
        <a href="#">Home</a>
        <a href="#">Create Bookings</a>
        <a href="#">View Bookings</a>
        <a href="activity-logs.html">Activity Logs</a>
        <a href="#" class="active">Inventory</a>
        <a href="#">Reports</a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <h1>Plot Inventory</h1>
      <button onclick="openPopup()">+ Add New Plot</button>
    </div>

    <!-- Inventory Table -->
    <div class="content-area">
      <table id="inventoryTable">
      <thead>
  <tr>
    <th>Item Name</th>
    <th>Category</th>
    <th>Total Plots</th>
    <th>Available Plots</th>
    <th>Price</th>
    <th>Last Update</th>
    <th>Actions</th>
  </tr>
    </thead>
    <tbody>
      <% plots.forEach(plot => { %>
        <tr>
          <td><%= plot.item_name %></td>
          <td><%= plot.category %></td>
          <td><%= plot.total_plots %></td>
          <td><%= plot.available_plots %></td>
          <td>â‚±<%= plot.default_price.toLocaleString() %></td>
          <td><%= plot.last_update ? new Date(plot.last_update).toLocaleString() : '-' %></td>
          <td class="actions">
            <button type="button" class="edit-btn" onclick='openPopup(true, <%- JSON.stringify(plot) %>)'>Edit</button>
            <form method="POST" action="/admin_inventory/delete/<%= plot.item_id %>" style="display:inline">
              <button type="submit" class="delete-btn">Delete</button>
            </form>
          </td>
        </tr>
      <% }); %>
    </tbody>
          </table>
        </div>

    <footer>
      <%- include('partials/footer') %>
    </footer>

  <!-- Popup Form -->
<div class="popup" id="plotPopup">
  <div class="popup-content">
    <h2>Add New Plots</h2>
    <form id="plotForm" method="POST" action="/admin_inventory/add-plots">

      <label>Select Plot (Item Name)</label>
      <select name="item_id" id="itemSelect" required>
        <option value="">Select a Plot</option>
        <% plots.forEach(plot => { %>
          <option value="<%= plot.item_id %>"><%= plot.item_name %> - <%= plot.category %></option>
        <% }); %>
      </select>

      <label>Number of Plots to Add</label>
      <input type="number" name="new_plots" id="newPlots" required min="1">

      <label>Default Price</label>
      <input type="number" name="default_price" id="price" required min="0">

      <div class="popup-actions">
        <button type="submit" class="save-btn">Add Plots</button>
        <button type="button" class="cancel-btn" onclick="closePopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openPopup() {
    document.getElementById("plotPopup").style.display = "flex";
    document.getElementById("plotForm").reset();
  }

  function closePopup() {
    document.getElementById("plotPopup").style.display = "none";
    document.getElementById("plotForm").reset();
  }
</script>
