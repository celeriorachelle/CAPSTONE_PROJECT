<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booking Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/stylesheets/bookplots.css">
</head>
<body>
  <%- include('partials/sidebar') %>
  <%- include('partials/topbar', { title: "Book" }) %>  

  <div class="main" id="main">
    <!-- Topbar -->
    
        <!-- Plot List Table -->
        <div class="plot-list-section" style="margin-left: 5%; margin-top: auto;">
          <h4>All Plots</h4>
          <div class="plot-table-container">
            <table class="plot-table">
              <thead>
                <tr>
                  <th>Plot No.</th>
                  <th>Location</th>
                  <th>Type</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="plotTableBody">
                <% plots.forEach(plot => { %>
                  <tr>
                    <td><%= plot.plot_number %></td>
                    <td><%= plot.location %></td>
                    <td><%= plot.type %></td>
                    <td>₱<%= plot.price.toLocaleString() %></td>
                    <td><%= plot.status %></td>
                    <td>
                      <% if(plot.status === 'available') { %>
                        <form method="POST" action="/bookplots/selectplot/<%= plot.plot_id %>" style="display:inline">
                          <button type="submit">BOOK</button>
                        </form>
                      <% } else if(plot.status === 'pending') { %>
                        <span style="color:orange;">Pending Approval</span>
                      <% } else { %>
                        <span>Not Available</span>
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <%- include('partials/footer') %>
    </footer>

    <script>
       // Sidebar toggle
    const sidebar = document.getElementById("sidebar");
    const btn = document.getElementById("toggleBtn");

    btn.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      btn.textContent = sidebar.classList.contains("collapsed") ? "▶" : "◀";
    });
  
      const searchInput = document.getElementById('plotSearch');
      searchInput.addEventListener('input', () => {
        const term = searchInput.value.toLowerCase();
        document.querySelectorAll('.plot-table tbody tr').forEach(row => {
          const text = row.innerText.toLowerCase();
          row.style.display = text.includes(term) ? '' : 'none';
        });
        document.querySelectorAll('#plotGrid .plot').forEach(div => {
          const text = div.innerText.toLowerCase();
          div.style.display = text.includes(term) ? 'block' : 'none';
        });
      });
    </script>
  </body>
</html>
