<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everlasting Peace Memorial Park Cemetery</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head> 
<body>
  <header class="header">
        <div class="nav-container" style="padding: 1%">
            <div class="left-nav-section">
                <div class="logo">
                    <img src="/images/system.png" alt="Memorial Services Logo" class="logo-img" style="height:50px;">
                </div>
                <nav class="nav-links">
                <a href="#support">ABOUT US</a>
                <a href="#support">SUPPORT</a>
                <a href="#contact">CONTACT US</a>
                <% if (user) { %>
                    <a href="/userdashboard">DASHBOARD</a>
                <% } %>
                </nav>
            </div>
          <div class="profile-dropdown-wrapper">
            <div class="profile-btn">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="dropdown-toggle">
                <i class="bi bi-caret-down-fill"></i>
            </div>
           <div class="dropdown-menu">
            <% if (user) { %>
                <span class="dropdown-link">Hi, <%= user.name %>!</span>
                <a href="/login/logout" class="dropdown-link">Logout</a>
            <% } else { %>
                <a href="/login" class="dropdown-link">Sign In</a>
                <a href="/register" class="dropdown-link">Sign Up</a>
            <% } %>
            </div>
        </div>
    
        </div>
    </div>
    <div class="text-content" style="width: 100%; padding: 7%;">
        <h1 class="cemetery-title"><span class="title-main">Everlasting Peace Memorial</span> <span class="title-sub"> <br>Park Cemetery</span></h1>
        <p class="subtitle">Gardens of Peace</p>
        <div class="section-content">
            <h2 class="section-header">A Place to Remember</h2>
            <p class="section-description">
                Discover our beautifully landscaped memorial gardens where memories live forever.<br>
                Explore different sections, each thoughtfully designed to provide comfort and serenity for families and visitors.
            </p>
        </div>
    </div>
    <main class="main-container" style="display: flex; flex-direction: column; width: 100%; padding: 7%;">
        <!-- Services Section -->
        <div class="services-section">
            <h2 class="services-title">Our Services</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/burial.jpg" alt="Burial Services">
                    </div>
                    <div class="service-content">
                        <h3>Burial Services</h3>
                        <p>Dignified burial services with compassionate care for your loved ones in our peaceful grounds.</p>
                        <a href="/book" class="service-btn">Learn More</a>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/memorial.jpg" alt="Memorial Services">
                    </div>
                    <div class="service-content">
                        <h3>Memorial Services</h3>
                        <p>Beautiful memorial ceremonies to honor and celebrate the life of your cherished family member.</p>
                        <a href="/book" class="service-btn">Learn More</a>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/plot.webp" alt="Plot Booking">
                    </div>
                    <div class="service-content">
                        <h3>Plot Booking</h3>
                        <p>Secure a peaceful resting place with our comprehensive plot selection and booking services.</p>
                        <a href="/book" class="service-btn">Book Now</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-column" style="padding-bottom: 10%;">
            <div class="search-fields">
                <div class="search-panel">
                    <h3 class="search-title">Find Your Loved Ones</h3>
                    <div class="search-grid">
                    <input type="text" class="search-input" placeholder="First Name" id="firstName">
                    <input type="text" class="search-input" placeholder="Middle Name" id="middleName">
                    <input type="text" class="search-input" placeholder="Last Name" id="lastName">
                    <input type="number" class="search-input" placeholder="Year Born" id="yearBorn" min="0" max="9999">
                    <input type="number" class="search-input" placeholder="Year Died" id="yearDied" min="0" max="9999">
                    <div class="search-action">
                        <button type="button" class="search-btn" onclick="applySearch()">
                            SEARCH
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="map-container" >
                    <h3 class="map-title">Cemetery Map</h3>
                    <div id="map"></div>
                </div>
            </div>
        </div>

<script>
        document.addEventListener("DOMContentLoaded", () => {
            const dropdownWrapper = document.querySelector(".profile-dropdown-wrapper");
            const dropdownMenu = document.querySelector(".dropdown-menu");
            const profileBtn = document.querySelector(".profile-btn");
            const dropdownToggle = document.querySelector(".dropdown-toggle");

            [profileBtn, dropdownToggle].forEach(btn => {
                btn.addEventListener("click", () => {
                    profileBtn.classList.toggle("active");
                    dropdownToggle.classList.toggle("active");
                });
            });

            document.addEventListener("click", (e) => {
                if (!e.target.closest(".profile-dropdown-wrapper")) {
                    profileBtn.classList.remove("active");
                    dropdownToggle.classList.remove("active");
                }
            });
        });

  function applySearch() {
    const filters = {
      firstName: document.getElementById("firstName").value.trim(),
      middleName: document.getElementById("middleName").value.trim(),
      lastName: document.getElementById("lastName").value.trim(),
      yearBorn: document.getElementById("yearBorn").value,
      yearDied: document.getElementById("yearDied").value
    };
    console.log("Applied Filters:", filters);
  }

                    document.addEventListener("DOMContentLoaded", function () {
                        const w = 1017; 
                        const h = 573;  

                        const map = L.map("map", {
                            crs: L.CRS.Simple,
                            minZoom: -1,
                            maxZoom: 4
                        });

                        const bounds = [[0,0], [h,w]];
                        L.imageOverlay("/images/map.png", bounds).addTo(map);
                        map.fitBounds(bounds);

                        const plotLayer = L.layerGroup().addTo(map);

                    
                        const categories = [
                            { name: "Garden A", coords: [100, 200], plots: [
                                {coords: [120, 210], status: "available", info: "Plot 1: John Doe, 1920-2000"},
                                {coords: [130, 220], status: "occupied", info: "Plot 2: Jane Smith, 1930-1990"},
                                {coords: [125, 215], status: "reserved", info: "Plot 3: Reserved"}
                            ]},
                            { name: "Garden B", coords: [300, 500], plots: [
                                {coords: [310, 510], status: "available", info: "Plot 4: Someone Else"}
                            ]}
                        ];

                        function getPlotColor(status) {
                        switch(status) {
                            case "available": return "green";
                            case "occupied": return "red";
                            case "reserved": return "yellow";
                            default: return "gray";
                        }
                    }
                    let currentZoomedPlot = null;
                    let originalView = null;

                    function showPlots(plots) {
                        plotLayer.clearLayers();
                        currentZoomedPlot = null; 

                        plots.forEach((p, index) => {
                            const color = getPlotColor(p.status);
                            const borderColor = color; 

                            const spacedCoords = [
                                p.coords[0] + (index * 60), // Add vertical spacing
                                p.coords[1] + (index * 60)  // Add horizontal spacing
                            ];

                            const icon = L.divIcon({
                                className: "plot-dot",
                                html: `<div style="
                                    width: 50px;
                                    height: 50px;
                                    border-radius: 25%;
                                    background-color: ${color};
                                    border: 2px solid black;
                                    margin: 10px;
                                "></div>`,
                                iconSize: [50, 50], // Updated to match the actual size
                                iconAnchor: [25, 25] // Center the larger dot
                            });

                            const marker = L.marker(spacedCoords, {icon: icon})
                            .addTo(plotLayer)
                            .bindPopup(p.info);

                            // Add click event for zoom functionality
                            marker.on('click', function(e) {
                                e.originalEvent.stopPropagation(); // Prevent map click event
                                
                                if (currentZoomedPlot === marker) {
                                    // If clicking the same plot, zoom out
                                    if (originalView) {
                                        map.setView(originalView.center, originalView.zoom);
                                    }
                                    currentZoomedPlot = null;
                                    originalView = null;
                                } else {
                                    // Store original view if not already stored
                                    if (!originalView) {
                                        originalView = {
                                            center: map.getCenter(),
                                            zoom: map.getZoom()
                                        };
                                    }
                                    
                                    // Zoom in to the clicked plot
                                    map.setView(spacedCoords, 4); // Higher zoom level
                                    currentZoomedPlot = marker;
                                }
                            });
                        });
                    }

                    // Icon for categories (larger dots)
                    function addCategoryMarkers(categories) {
                        categories.forEach(cat => {
                            const icon = L.divIcon({
                                className: "category-dot",
                                html: `<div style="
                                    width: 10px;
                                    height: 10px;
                                    border-radius: 50%;
                                    background-color: yellow;
                                    border: 2px solid yellow;
                                "></div>`,
                                iconSize: [10, 10],
                                iconAnchor: [12, 12]
                            });

                            const marker = L.marker(cat.coords, {icon: icon}).addTo(map);
                            marker.bindPopup(`<b>${cat.name}</b><br>Click to view plots`);

                            marker.on('click', () => {
                                map.setView(cat.coords, 2); // zoom in
                                showPlots(cat.plots);
                            });
                        });
                    }

                    // Add categories to the map
                    addCategoryMarkers(categories);

                    // Add map click event to zoom out when clicking empty space
                    map.on('click', function(e) {
                        if (currentZoomedPlot && originalView) {
                            map.setView(originalView.center, originalView.zoom);
                            currentZoomedPlot = null;
                            originalView = null;
                        } else if (map.getZoom() >= 2) {
                            // If we're zoomed in to a garden view, zoom out to main view and clear plots
                            map.fitBounds(bounds);
                            plotLayer.clearLayers();
                            currentZoomedPlot = null;
                            originalView = null;
                        }
                    });

                    });
                    </script>
            </div>
        </div>
    </main>
    <script>
        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
        
            
            // Add entrance animation delay
            setTimeout(() => {
                document.querySelector('.content-section').style.opacity = '1';
                document.querySelector('.search-section').style.opacity = '1';
            }, 300);
        });

        // Add keyboard support for search
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchRecords();
            }
        });

        
    </script>   
    <footer class="footer-info">
    <div class="footer-content">
        
        <div class="footer-section">
            <h4><i class="fa-solid fa-clock"></i> Office Hours</h4>
            <p>Mon-Fri: 8:00 AM - 6:00 PM<br>
            Sat-Sun: 9:00 AM - 4:00 PM</p>
        </div>
        
        <div class="footer-section">
            <h4><i class="fa-solid fa-location-dot"></i> Visit Us</h4>
            <p>123 Memorial Drive<br>
            Peaceful Valley, CA 90210</p>
        </div>
        
        <div class="footer-section">
            <h4><i class="fa-solid fa-phone"></i> Call Us</h4>
            <p><a href="tel:555-123-4567">(555) 123-4567</a><br>
            Available 24/7</p>
        </div>
        
        <div class="footer-section">
            <h4><i class="fa-solid fa-envelope"></i> Email Us</h4>
            <p>
                <a href="mailto:info@everlastingpeace.com">info@everlastingpeace.com</a><br>
                <a href="mailto:support@everlastingpeace.com">support@everlastingpeace.com</a>
            </p>
        </div>
        
        <div class="footer-section">
            <div style="display: flex; gap: 2rem; align-items: flex-start;">
                <div>
                    <h4><i class="fa-brands fa-facebook"></i> Facebook Page</h4>
                    <p><a href="#">Everlasting PEACE Memorial Park</a></p>
                </div>
                <div>
                    <h4><i class="fa-solid fa-circle-question"></i> Frequently Asked Questions</h4>
                    <p><a href="#faq">FAQs</a></p>
                </div>
            </div>
        </div>

    </div>
</footer>
</body>
</html>